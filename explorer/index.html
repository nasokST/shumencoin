<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ShumenCoin Explorer</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.18/js/dataTables.bootstrap.min.js "></script>
<style type="text/css">
	.bs-example{
		margin: 20px;
	}
</style>

<script type="application/javascript">
$( document ).ready(function() {

	(function(){
	   var f = function() {
	   $.ajax({
		  url: 'http://localhost:8080/blocks',
		  type: 'GET',
		  dataType: 'json',
		  success: function(data) { 
			fillInBlocksTable(data);
		  },
		  beforeSend: setHeader
		});
		
		$.ajax({
			url: 'http://localhost:8080/transactions/confirmed',
			type: 'GET',
			dataType: 'json',
			success: function(data) { 
				fillInTransactionTable(data,"confirmed-transactions-table");
			},
			beforeSend: setHeader
		});
		
		$.ajax({
			url: 'http://localhost:8080/transactions/pending',
			type: 'GET',
			dataType: 'json',
			success: function(data) { 
				fillInTransactionTable(data,"pending-transactions-table");
			},
			beforeSend: setHeader
		});

		
	   };
	   window.setInterval(f, 10000);
	   f();
	})();

  	
	function fillInBlocksTable(data) {
		$('#block-table').DataTable().clear().destroy();
		$.each(data, function(index, element) { 		
			var html = "<tr>"
						+ "<td>" + element.index +"</td>"
						+ "<td>" + element.dificulty +"</td>"
						+ "<td style='width:40px'>" + element.minedBy +"</td>"
						+ "<td>" + element.nonce +"</td>"
						+ "<td>" + element.creationDate +"</td>"
						+ "<td style='max-width:150px; white-space:pre-wrap; word-wrap:break-word;'>" + element.blockDataHash +"</td>"
						+ "<td style='max-width:150px; white-space:pre-wrap; word-wrap:break-word;'>" + element.blockHash +"</td>"
						+ "<td style='max-width:150px; white-space:pre-wrap; word-wrap:break-word;'>" + element.prevBlockHash +"</td>"
						+ "<td style='max-width:100px; white-space:pre-wrap; word-wrap:break-word;'>" + JSON.stringify(element.transactions) +"</td>"
					+ "</tr>";
			$( "#block-table-body" ).append(html);
		});
		$('#block-table').DataTable({
                "fixedHeader": true,
                "responsive": true,
				"lengthChange": false,               
				"searching": false,
				"paginate": false,
				"info": false,});
	}
		
	function fillInTransactionTable(data, table) {
		$('#' + table).DataTable().clear().destroy();	
		$.each(data, function(index, element) {
			var html = "<tr>"
			+ "<td>" + element.from + "</td>"
			+ "<td>" + element.to + "</td>"
			+ "<td>" + element.value + "</td>"
			+ "<td>" + element.fee + "</td>"
			+ "<td>" + element.dateCreated + "</td>"
			+ "<td>" + element.data + "</td>"
			+ "<td>" + element.senderPubKey + "</td>"
			+ "<td>" + element.transactionDataHash+ "</td>"
			+ "<td>" + element.minedInBlockIndex + "</td>"
			+ "<td>" + (element.transferSuccessful?"true":"false")+ "</td>";
			$( "#" + table + "-body" ).append(html);
		});	
		$('#' + table).DataTable({
                "fixedHeader": true,
                "responsive": true,
				"lengthChange": false,               
				"searching": false,
				"paginate": false,
				"info": false,});
	}
	
	function setHeader(xhr) {
		xhr.setRequestHeader('Origin', 'http://localhost:8080/');
	}
	
});

</script>
</head>
<body>
<div class="bs-example">
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#sectionA">Blocks</a></li>
        <li><a data-toggle="tab" href="#sectionB">Confirmed Transactions</a></li>
        <li><a data-toggle="tab" href="#sectionC">Pending Transactions</a></li>
        <li class='pull-right'><h4>ShumenCoin</h4></li>
    </ul>
    <div class="tab-content">
        <div id="sectionA" class="tab-pane fade in active">
            <h3>Blocks</h3>
			<div class="container-fluid">
				<table id="block-table" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th>Index</th>
							<th>Dificulty</th>
							<th>MinedBy</th>
							<th>Nonce</th>
							<th>CreationDate</th>
							<th>BlockDataHash</th>
							<th>BlockHash</th>
							<th>PrevBlockHash</th>
							<th>Transactions</th>
						</tr>
					</thead>
					<tbody id="block-table-body">
					</tbody>
				</table>
			</div>
        </div>
        <div id="sectionB" class="tab-pane fade">
            <h3>Confirmed Transactions</h3>
			<div class="container-fluid">
				<table id="confirmed-transactions-table" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th>From</th>
							<th>To</th>
							<th>Value</th>
							<th>Fee</th>
							<th>Date Created</th>
							<th>Data</th>
							<th>SenderPubKey</th>
							<th>TransactionDataHash</th>
							<th>MinedInBlockIndex</th>
							<th>Transfer Successfull</th>
						</tr>
					</thead>
					<tbody id="confirmed-transactions-table-body">
					</tbody>
				</table>
			</div>
        </div>
        <div id="sectionC" class="tab-pane fade">
            <h3>Pending Transactions</h3>
			<div class="container-fluid">
				<table id="pending-transactions-table" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th>From</th>
							<th>To</th>
							<th>Value</th>
							<th>Fee</th>
							<th>Date Created</th>
							<th>Data</th>
							<th>SenderPubKey</th>
							<th>TransactionDataHash</th>
							<th>MinedInBlockIndex</th>
							<th>Transfer Successfull</th>
						</tr>
					</thead>
					<tbody id="pending-transactions-table-body">
					</tbody>
				</table>
			</div>
        </div>
    </div>
</div>
</body>
</html>                            